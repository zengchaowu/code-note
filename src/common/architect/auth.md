鉴权（Authentication）是指在计算机系统中，验证用户身份的过程，确保用户拥有所请求的资源的合法权限。

## 鉴权的方式

1. 数字证书鉴权，数字证书由机构颁发，包含一些基本信息和公钥。
2. OAuth鉴权。OAuth是一种授权协议，它允许用户授权第三方应用程序访问他们的资源，而无需将用户名和密码共享给第三方应用程序。
3. API密钥认证。在请求头中提供API密钥作为凭证，服务器通过验证密钥来确定用户是否有权访问资源。
4. token认证。在请求头中提供Token作为凭证。服务器通过验证Token来确定用户是否有权访问资源。


## OAuth2.0

OAuth2.0协议的主要参与方包括资源拥有者（Resource Owner）、客户端（Client）和授权服务器（Authorization Server）。资源拥有者是指资源的拥有者或代理，客户端是指需要访问资源的第三方应用程序，授权服务器是指负责对资源进行授权的服务器。

常用的OAuth 2.0授权访问方式包括授权码模式（Authorization Code Grant）和隐式授权模式（Implicit Grant）。它们的使用场景不同：

### 授权码模式

适用于客户端在服务器上运行的应用程序，客户端可以保持客户端ID和客户端密钥的机密性。它可以将访问令牌保存在服务器端，客户端可以在后续的请求中使用它。流程如下：

1. 客户端携带（客户端id，请求范围，重定向URI）向授权服务器发起请求。
2. 授权服务器向用户展示客户端信息和请求范围
3. 用户同意，授权服务器生成一个授权码，通过附加在重定向URI中作为参数返回给客户端。
4. 客户端携带（授权码，客户端id，客户端密钥，重定向URI）向授权服务器请求访问令牌。
5. 授权服务器验证通过后，则返回令牌（访问令牌，刷新令牌，令牌类型和有效期）
6. 客户端使用访问令牌向资源服务器请求访问资源。如果访问令牌过期，客户端可以使用刷新令牌获取新的访问令牌。

**为什么使用重定向URI**

这里的重定向URI主要作用是将授权码返回给客户端，之所以不通过http直接返回的原因是，如果直接将它们返回给客户端，容易被黑客窃取。使用重定向URI的方式，可以将授权码或访问令牌作为参数附加在重定向URI中，然后将重定向URI发送到客户端。客户端在收到重定向URI后，可以从中获取授权码或访问令牌，从而完成认证和授权。重定向URI通常是需要在授权服务器上注册的，只有注册过的URI，授权服务器才会发起请求将授权码带回。

第四步中，请求仍然带上重定向URI的作用主要是出于安全考虑。授权服务器会严重这个URI和授权码是否匹配。

**令牌过期处理**

当访问令牌过期后，客户端可以使用刷新令牌来获取新的访问令牌。刷新令牌是在获取访问令牌时一并返回的，具有更长的有效期限，并且只能用于获取新的访问令牌，而不能直接用于访问资源服务器。

**立刻废除令牌**

### 隐式授权模式

适用于客户端在用户代理（如浏览器）中运行的应用程序。因为客户端ID和密钥将公开在JavaScript中，所以它适用于无法保证客户端机密性的应用程序。



## 核心服务

1. 用户管理服务，用于判断用户信息是否正确。
2. 令牌服务，负责生成令牌。
3. 鉴权服务，负责协调用户管理服务和令牌服务。用户发起请求时，到达鉴权服务，鉴权服务再通过用户管理服务判断信息是否正确，如果正确则调用令牌服务生成令牌并返回给用户。
4. 访问控制服务，负责判断验证令牌是否对某个资源有权限。如果拥有权限，则直接获取相应资源返回给用户，否则返回错误信息。

用户发起鉴权请求->

## 